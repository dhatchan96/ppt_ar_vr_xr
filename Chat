import wx
import os
import pandas as pd

class FileExtractor(wx.Frame):
    def __init__(self):
        super().__init__(parent=None, title="PDF Extractor - Config Based", size=(650, 450))
        notebook = wx.Notebook(self)

        self.pdf_dir_path = ""
        self.config_file_path = ""
        self.output_path = ""

        # === Tab 1 ===
        tab1 = wx.Panel(notebook)

        # PDF Directory Selection
        pdf_label = wx.StaticText(tab1, label="Select PDF Directory:", pos=(20, 20))
        self.pdf_path_ctrl = wx.TextCtrl(tab1, style=wx.TE_READONLY, pos=(20, 45), size=(450, 25))
        self.pdf_path_ctrl.SetBackgroundColour(wx.Colour(230, 240, 255))  # Light Blue
        pdf_btn = wx.Button(tab1, label="Browse PDF Folder", pos=(480, 45))
        pdf_btn.Bind(wx.EVT_BUTTON, self.browse_pdf_directory)

        # Config Excel File Selection
        config_label = wx.StaticText(tab1, label="Select Config Excel File:", pos=(20, 90))
        self.config_path_ctrl = wx.TextCtrl(tab1, style=wx.TE_READONLY, pos=(20, 115), size=(450, 25))
        self.config_path_ctrl.SetBackgroundColour(wx.Colour(240, 230, 255))  # Light Purple
        config_btn = wx.Button(tab1, label="Browse Config File", pos=(480, 115))
        config_btn.Bind(wx.EVT_BUTTON, self.browse_config_file)

        # Output Path
        output_label = wx.StaticText(tab1, label="Output File Path:", pos=(20, 160))
        self.output_path_ctrl = wx.TextCtrl(tab1, style=wx.TE_READONLY, pos=(20, 185), size=(450, 25))
        self.output_path_ctrl.SetBackgroundColour(wx.Colour(230, 255, 230))  # Light Green
        output_btn = wx.Button(tab1, label="Choose Output File", pos=(480, 185))
        output_btn.Bind(wx.EVT_BUTTON, self.choose_output_file)

        # Process Button
        process_btn = wx.Button(tab1, label="Extract and Save", pos=(20, 240))
        process_btn.Bind(wx.EVT_BUTTON, self.process_files)

        # === Tab 2 ===
        tab2 = wx.Panel(notebook)
        self.file_listbox = wx.ListBox(tab2, pos=(20, 20), size=(580, 350))

        notebook.AddPage(tab1, "PDF Extraction")
        notebook.AddPage(tab2, "PDF Files Found")

        self.Show()

    def browse_pdf_directory(self, event):
        with wx.DirDialog(self, "Select PDF Directory") as dialog:
            if dialog.ShowModal() == wx.ID_OK:
                self.pdf_dir_path = dialog.GetPath()
                self.pdf_path_ctrl.SetValue(self.pdf_dir_path)

    def browse_config_file(self, event):
        with wx.FileDialog(self, "Select Config Excel File", wildcard="Excel files (*.xls;*.xlsx)|*.xls;*.xlsx",
                           style=wx.FD_OPEN | wx.FD_FILE_MUST_EXIST) as dialog:
            if dialog.ShowModal() == wx.ID_OK:
                self.config_file_path = dialog.GetPath()
                self.config_path_ctrl.SetValue(self.config_file_path)

    def choose_output_file(self, event):
        with wx.FileDialog(self, "Save Output File", wildcard="Excel files (*.xlsx)|*.xlsx",
                           style=wx.FD_SAVE | wx.FD_OVERWRITE_PROMPT) as dialog:
            if dialog.ShowModal() == wx.ID_OK:
                self.output_path = dialog.GetPath()
                self.output_path_ctrl.SetValue(self.output_path)

    def process_files(self, event):
        if not self.pdf_dir_path or not self.config_file_path:
            wx.MessageBox("Please select both PDF directory and Config Excel file!", "Error", wx.ICON_ERROR)
            return

        combined_df = pd.DataFrame()

        # Process Config Excel File (placeholder usage)
        try:
            config_df = pd.read_excel(self.config_file_path)
            combined_df = config_df.copy()  # Replace with actual processing logic
        except Exception as e:
            wx.MessageBox(f"Error reading config file:\n{str(e)}", "Error", wx.ICON_ERROR)
            return

        # List PDF files (you can add actual parsing logic here)
        pdf_files = [os.path.join(self.pdf_dir_path, f) for f in os.listdir(self.pdf_dir_path)
                     if f.lower().endswith(".pdf")]
        self.file_listbox.Clear()
        self.file_listbox.InsertItems(pdf_files, 0)

        print("PDFs found:")
        for pdf in pdf_files:
            print(pdf)

        if self.output_path:
            combined_df.to_excel(self.output_path, index=False)
            wx.MessageBox("File saved successfully!", "Success")
        else:
            wx.MessageBox("Please choose an output file path!", "Error", wx.ICON_ERROR)

if __name__ == '__main__':
    app = wx.App(False)
    frame = FileExtractor()
    app.MainLoop()
